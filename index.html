<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daily Count - Production</title>
    <style>
        :root { --brand: #f97316; --brand-grad: linear-gradient(135deg, #f97316, #ef4444); --bg: #09090b; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; padding: 20px; }
        .hidden { display: none !important; }
        
        /* Unresolved Area */
        #unresolvedContainer { border: 1px solid #ef4444; background: rgba(239, 68, 68, 0.1); border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .unresolved-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        
        /* Master List UI */
        .inventory-row { display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; background: rgba(24, 24, 27, 0.7); border-radius: 1rem; border: 1px solid #27272a; margin-bottom: 0.75rem; }
        .qty-badge { background: var(--brand-grad); padding: 0.5rem 1.5rem; border-radius: 0.75rem; font-weight: 800; cursor: pointer; }
        
        /* Voice Overlay */
        #voiceOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .pulse-mic { width: 100px; height: 100px; background: var(--brand); border-radius: 50%; box-shadow: 0 0 30px var(--brand); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); opacity: 0.8; } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <header style="text-align:center; margin-bottom: 30px;"><img src="logo.png" style="width:200px; filter:drop-shadow(0 0 10px var(--brand))"></header>

    <div id="unresolvedContainer" class="hidden">
        <h4 style="margin:0 0 10px 0; color:#ef4444;">Unresolved Commands</h4>
        <div id="queueItems"></div>
    </div>

    <div id="masterList"></div>

    <div id="voiceOverlay" class="hidden" onclick="stopDailyRecord()">
        <div class="pulse-mic"></div>
    </div>

    <button id="recordBtn" onclick="startDailyRecord()" style="position:fixed; bottom:30px; right:30px; width:80px; height:80px; border-radius:50%; background:var(--brand-grad); border:none;"></button>

    <script>
        let inventory = {}; // Canonical State
        let queue = []; // Unresolved State

        // 3.3 Unresolved Handling: Non-blocking queue
        function renderQueue() {
            const container = document.getElementById('unresolvedContainer');
            if (queue.length === 0) return container.classList.add('hidden');
            
            container.classList.remove('hidden');
            document.getElementById('queueItems').innerHTML = queue.map((u, i) => `
                <div class="unresolved-item">
                    <span>"${u.transcript}"</span>
                    <div>
                        <button onclick="resolveNow(${i})">Resolve</button>
                        <button onclick="bypassNow(${i})" style="opacity:0.5; margin-left:10px;">Bypass</button>
                    </div>
                </div>
            `).join('');
        }

        // 5) Human Correction overrides automation
        function manualEdit(item) {
            const newVal = prompt(`Set quantity for ${item}:`, inventory[item] || 0);
            if (newVal !== null) {
                inventory[item] = parseFloat(newVal) || 0;
                renderList();
            }
        }

        function renderList() {
            const list = document.getElementById('masterList');
            list.innerHTML = Object.keys(inventory).map(item => `
                <div class="inventory-row">
                    <span>${item}</span>
                    <div class="qty-badge" onclick="manualEdit('${item}')">${inventory[item]}</div>
                </div>
            `).join('');
        }

        async function startDailyRecord() { document.getElementById('voiceOverlay').classList.remove('hidden'); }
        async function stopDailyRecord() { document.getElementById('voiceOverlay').classList.add('hidden'); }
    </script>
</body>
</html>
